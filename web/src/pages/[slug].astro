---
import Layout from '../layouts/Layout.astro';
import { sanityClient, fetchGlobalSettings } from "../lib/sanityClient";
import {buildLayoutProps} from "../lib/head";
import PageRenderer from "../components/PageRenderer.astro";

export async function getStaticPaths() {
    try {
        const pages = await sanityClient.fetch(`
            *[_type == "page" && slug.current != "inicio"] {
                slug,
                title,
                blocks[]{
                    _type,
                    ...
                }
            }
        `);

        return pages.map((page: { slug: { current: string }, title: string, blocks: any[] }) => ({
            params: { slug: page.slug.current },
            props: { page }
        }));
    } catch (_err) {
        return [];
    }
}

interface CmsPage {
    title?: string;
    blocks?: any[];
}

const { page } = Astro.props as { page: CmsPage };
const settings = await fetchGlobalSettings();
const layoutProps = buildLayoutProps(page, settings);
---

<Layout {...layoutProps}>
  <PageRenderer blocks={page?.blocks} />
</Layout>