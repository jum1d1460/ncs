---
import Layout from '../layouts/Layout.astro';
import { sanityClient, fetchGlobalSettings } from "../lib/sanityClient";
import {buildLayoutProps} from "../lib/head";
import PageRenderer from "../components/PageRenderer.astro";

// Obtener la p√°gina de inicio desde Sanity (tolerante a errores)
let inicioPage: any = null;
try {
    inicioPage = await sanityClient.fetch(`
        *[_type == "page" && slug.current == "inicio"][0]{
            title,
            blocks[]{
                _type,
                ...
            }
        }
    `);
} catch (_err) {
    inicioPage = null;
}

const page = inicioPage || {
    title: "Inicio",
    blocks: []
};

const settings = await fetchGlobalSettings();
const layoutProps = buildLayoutProps(page, settings);
---

<Layout {...layoutProps}>
  <PageRenderer blocks={page.blocks} />
</Layout>
